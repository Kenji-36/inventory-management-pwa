# 在庫注文管理システム - 機能・技術スタック一覧

## 📅 最終更新: 2026年2月16日

---

## 1. 基本実装機能（コア機能）

### 1.1 認証・認可
| 機能 | 説明 |
|------|------|
| Google OAuth ログイン | Supabase Auth + Google Provider によるシングルサインオン |
| セッション管理 | Cookie ベースのセッション維持・自動更新 |
| ログアウト | セッション破棄とリダイレクト処理 |
| 権限管理 | 管理者 (admin) / 一般ユーザー (user) の2ロール |
| 認証ミドルウェア | 未認証アクセスのリダイレクト制御 |

### 1.2 在庫管理（SKU管理）
| 機能 | 説明 |
|------|------|
| 商品一覧表示 | SKU入れ子構造（同一商品コードの親子グルーピング） |
| 商品検索 | 商品名・商品コード・JANコードによる検索 |
| 在庫数量更新 | 手動での在庫数更新 + リアルタイム反映 |
| バーコードスキャン | カメラによるJANコード読み取り → 在庫+1自動更新 |
| 商品画像管理 | アップロード・プレビュー・削除（Supabase Storage） |
| サムネイル表示 | 商品一覧・注文画面での画像サムネイル + Lazy Loading |
| CSV入出力 | テンプレートDL・CSVアップロード・一括更新 |
| ページネーション | 商品一覧のページ分割表示 |
| ソート | 商品名・在庫数・更新日時でのソート |

### 1.3 注文管理（受注管理）
| 機能 | 説明 |
|------|------|
| 注文一覧 | 全注文の一覧表示（日付グループ化） |
| 注文詳細 | 注文番号・日時・商品一覧・税込/税抜金額表示 |
| 新規注文作成 | バーコードスキャン or 手動で商品追加 → 確定 |
| 数量調整 | +/- ボタンによる注文商品数量変更 |
| 在庫自動減算 | 注文確定時にトランザクションで在庫を自動減算 |
| テストデータ追加 | 設定画面からランダムな注文データを一括生成 |

### 1.4 ダッシュボード
| 機能 | 説明 |
|------|------|
| 売上推移グラフ | 日別/週別/月別の売上推移（折れ線・棒グラフ） |
| 注文数サマリー | 本日・今週・今月の注文数表示 |
| 在庫情報サマリー | 総商品数・在庫切れ数・低在庫アラート |
| 商品別売上分析 | 売上上位商品ランキング表示 |

### 1.5 リアルタイム機能
| 機能 | 説明 |
|------|------|
| 在庫リアルタイム更新 | Supabase Realtime による即時反映 |
| 注文リアルタイム通知 | 新規注文の即時通知 |
| 複数ユーザー同時編集 | WebSocket による同時操作対応 |

### 1.6 PWA対応
| 機能 | 説明 |
|------|------|
| Web App Manifest | ホーム画面への追加・ネイティブ風表示 |
| Service Worker | キャッシュ戦略・オフライン対応 |
| レスポンシブデザイン | PC・タブレット・スマートフォン対応 |
| アイコン | PWA用アプリアイコン |

---

## 2. 拡張版機能（追加実装済み）

### 2.1 CI/CD パイプライン（2026-02-13 完了）
| 機能 | 説明 |
|------|------|
| GitHub Actions (test.yml) | プルリクエスト / push 時に Lint + Test + Build 自動実行 |
| GitHub Actions (e2e.yml) | Playwright による E2E テスト自動実行 |
| Vercel 自動デプロイ | main ブランチへのマージで本番自動デプロイ |
| プレビューデプロイ | PR ごとにプレビュー環境を自動生成 |
| ステータスバッジ | README にテスト結果バッジ表示 |

### 2.2 エラー監視・ログ管理（2026-02-15 完了）
| 機能 | 説明 |
|------|------|
| Sentry エラートラッキング | クライアント/サーバー/エッジのエラー自動収集 |
| Vercel Analytics | アクセス解析・パフォーマンス計測 |
| グローバルエラーハンドリング | error.tsx によるフォールバックUI |
| エラーバウンダリー | React Error Boundary コンポーネント |
| エラーテストページ | /test-error で5種類のエラーを手動テスト可能 |
| CSP (Content Security Policy) | XSS防止のためのセキュリティヘッダー設定 |

### 2.3 ユーザー権限管理の強化（2026-02-15 完了）
| 機能 | 説明 |
|------|------|
| 管理者ダッシュボード | /admin で管理者専用画面（ユーザー管理 + 監査ログ） |
| ユーザー一覧・編集 | 全ユーザーの表示・ロール変更 |
| 監査ログ (Audit Log) | 主要操作（注文作成・在庫更新・CSV・ロール変更等）を自動記録 |
| RLS ポリシー細分化 | 管理者/一般ユーザーごとのデータアクセス制御 |
| API レート制限 | Upstash Redis によるリクエスト数制限 |
| 管理者メニュー制御 | ヘッダーナビで管理者のみに管理メニュー表示 |

### 2.4 高度な在庫管理機能（2026-02-15 完了）
| 機能 | 説明 |
|------|------|
| 入出庫履歴記録 | 入庫/出庫/棚卸調整/注文出庫の全履歴を自動記録 |
| 入出庫履歴閲覧 | 種類別フィルタ・変動前後の在庫数表示 |
| 棚卸機能 | 実在庫入力 → 理論在庫との差異チェック → 一括調整 |
| 在庫予測（需要予測） | 過去30日の平均日販ベースで在庫切れ予測日を算出 |
| 発注推奨アラート | 在庫切れ7日以内の商品に警告表示 |
| 高度な管理画面 | /inventory/history で3タブ構成（履歴/棚卸/予測） |

### 2.5 レポート・分析機能（2026-02-15 完了）
| 機能 | 説明 |
|------|------|
| レポート専用ページ | /reports で売上分析ダッシュボード |
| 期間プリセット | 7日/30日/今月/先月/90日/今年をワンクリック選択 |
| カスタム期間指定 | 任意の開始日・終了日で分析 |
| サマリーカード | 総注文数・売上(税込/税抜)・販売商品数・平均注文額 |
| 日別売上チャート | 棒グラフ(売上) + 折れ線(注文数) の複合チャート |
| 商品別売上ランキング | 列ヘッダークリックでソート切替 |
| 期間比較分析 | 前月比・前年比の比較チャート + 変動率バッジ |
| PDF エクスポート | サマリー + 商品別売上表をPDF出力（日本語フォント対応） |
| Excel エクスポート | 3シート構成（サマリー/商品別/日別）、数値カンマ書式 |

---

## 3. テスト基盤

| カテゴリ | 内容 |
|----------|------|
| 単体テスト | Jest によるバリデーション関数テスト |
| コンポーネントテスト | Testing Library による Button・Card テスト |
| 統合テスト | 商品API・注文API・在庫管理シナリオ |
| パフォーマンステスト | データ処理・CSV・メモリ計測 |
| E2E テスト | Playwright によるログイン・在庫管理ページテスト |
| テスト合計 | **41 単体/統合テスト + 5 E2E テスト** |

---

## 4. 技術スタック

### 4.1 フロントエンド

| 技術 | バージョン | 用途 |
|------|-----------|------|
| **Next.js** | 16.1.6 | React フレームワーク（App Router） |
| **React** | 19.1.0 | UI ライブラリ |
| **TypeScript** | 5.8.3 | 型安全な JavaScript |
| **Tailwind CSS** | 4.1.4 | ユーティリティファーストCSS |
| **shadcn/ui** | - | UIコンポーネントライブラリ（Radix UI ベース） |
| **Recharts** | 3.7.0 | グラフ・チャート描画（React + D3） |
| **Zustand** | 5.0.11 | 軽量状態管理 |
| **Lucide React** | 0.563.0 | アイコンライブラリ |
| **html5-qrcode** | 2.3.8 | バーコード / QRコード スキャン |
| **jsPDF** | 4.1.0 | PDF 生成 |
| **jspdf-autotable** | 5.0.7 | jsPDF テーブル描画プラグイン |
| **xlsx** | 0.18.5 | Excel (XLSX) ファイル読み書き |
| **class-variance-authority** | 0.7.1 | コンポーネントバリアント管理 |
| **clsx** | 2.1.1 | 条件付きクラス名結合 |
| **tailwind-merge** | 3.4.0 | Tailwind クラス名マージ |

### 4.2 バックエンド (BaaS)

| 技術 | バージョン | 用途 |
|------|-----------|------|
| **Supabase** | - | Backend as a Service（統合プラットフォーム） |
| **@supabase/supabase-js** | 2.95.3 | Supabase JavaScript クライアント |
| **@supabase/ssr** | 0.8.0 | Supabase サーバーサイドレンダリング対応 |
| **PostgreSQL** | 15 | リレーショナルデータベース |
| **Supabase Auth** | - | 認証基盤（Google OAuth Provider） |
| **Supabase Storage** | - | ファイルストレージ（商品画像） |
| **Supabase Realtime** | - | WebSocket リアルタイム同期 |
| **Row Level Security** | - | 行レベルセキュリティ |

### 4.3 監視・分析

| 技術 | バージョン | 用途 |
|------|-----------|------|
| **@sentry/nextjs** | 10.38.0 | エラートラッキング・パフォーマンス監視 |
| **@vercel/analytics** | 1.6.1 | Web アクセス解析 |

### 4.4 レート制限

| 技術 | バージョン | 用途 |
|------|-----------|------|
| **@upstash/ratelimit** | 2.0.8 | API レート制限 |
| **@upstash/redis** | 1.36.2 | サーバーレス Redis（レート制限用） |

### 4.5 PWA

| 技術 | バージョン | 用途 |
|------|-----------|------|
| **@ducanh2912/next-pwa** | 10.2.9 | Next.js 用 PWA プラグイン |
| **Service Worker** | - | オフラインキャッシュ・プッシュ通知基盤 |
| **Web App Manifest** | - | PWA インストール設定 |

### 4.6 テスト

| 技術 | バージョン | 用途 |
|------|-----------|------|
| **Jest** | 30.2.0 | 単体テスト・統合テストフレームワーク |
| **jest-environment-jsdom** | 30.2.0 | ブラウザ環境シミュレーション |
| **@testing-library/react** | 16.3.2 | React コンポーネントテスト |
| **@testing-library/jest-dom** | 6.9.1 | DOM アサーション拡張 |
| **@testing-library/user-event** | 14.6.1 | ユーザーイベントシミュレーション |
| **@playwright/test** | 1.58.2 | E2E テストフレームワーク |

### 4.7 開発ツール・インフラ

| 技術 | 用途 |
|------|------|
| **ESLint** (9.26.0) | 静的解析・コード品質チェック |
| **PostCSS** (8.5.3) | CSS 変換・処理 |
| **Autoprefixer** (10.4.21) | CSS ベンダープレフィックス自動付与 |
| **Git / GitHub** | バージョン管理・コード管理 |
| **GitHub Actions** | CI/CD（自動テスト・自動デプロイ） |
| **Vercel** | ホスティング（サーバーレスデプロイ） |
| **npm** | パッケージ管理 |

### 4.8 フォント・アセット

| リソース | 用途 |
|----------|------|
| **Noto Sans JP** (Google Fonts) | PDF エクスポート用日本語フォント |
| **Geist / Geist Mono** | アプリケーション UI フォント |

---

## 5. データベース構成

### テーブル一覧（7テーブル）

| テーブル | 説明 | レコード例 |
|----------|------|-----------|
| **products** | 商品マスタ（商品名・SKU・JAN・価格） | 30件（初期データ） |
| **stock** | 在庫情報（商品別の現在在庫数） | 30件（初期データ） |
| **orders** | 注文情報（注文日時・合計金額） | 5件～（初期 + テストデータ） |
| **order_details** | 注文詳細（注文内の商品別明細） | 40件～（初期 + テストデータ） |
| **users** | ユーザー（メール・ロール） | Google Auth 連携 |
| **audit_logs** | 監査ログ（操作履歴の記録） | 主要操作を自動記録 |
| **stock_movements** | 入出庫履歴（在庫変動の全記録） | 入庫/出庫/棚卸/注文 |

---

## 6. 画面一覧（全ページ）

| # | 画面名 | URL | 区分 |
|---|--------|-----|------|
| 1 | ログイン | /login | 基本 |
| 2 | ダッシュボード | / | 基本 |
| 3 | 在庫一覧 | /inventory | 基本 |
| 4 | 在庫詳細・編集 | /inventory/[id] | 基本 |
| 5 | バーコードスキャン | /inventory/scan | 基本 |
| 6 | CSV管理 | /inventory/csv | 基本 |
| 7 | 高度な在庫管理 | /inventory/history | 拡張 |
| 8 | 注文一覧 | /orders | 基本 |
| 9 | 注文詳細 | /orders/[id] | 基本 |
| 10 | 新規注文 | /orders/new | 基本 |
| 11 | レポート・分析 | /reports | 拡張 |
| 12 | 管理者ダッシュボード | /admin | 拡張 |
| 13 | 設定 | /settings | 基本 |
| 14 | エラーテスト | /test-error | 拡張（開発用） |

---

## 7. API エンドポイント一覧

### 基本 API
| メソッド | エンドポイント | 説明 |
|----------|---------------|------|
| GET | /api/products | 商品一覧取得 |
| GET | /api/products/[id] | 商品詳細取得 |
| POST | /api/products | 商品作成 |
| PUT | /api/products/[id] | 商品更新 |
| DELETE | /api/products/[id] | 商品削除 |
| POST | /api/products/[id]/image | 商品画像アップロード |
| DELETE | /api/products/[id]/image | 商品画像削除 |
| GET | /api/stock | 在庫一覧取得 |
| PUT | /api/stock | 在庫更新 |
| POST | /api/stock/scan | バーコードスキャン |
| GET | /api/orders | 注文一覧取得 |
| GET | /api/orders/[id] | 注文詳細取得 |
| POST | /api/orders | 注文作成（在庫自動減算 + 入出庫記録） |
| GET | /api/dashboard | 売上統計 |
| GET | /api/dashboard/ranking | 商品ランキング |

### 拡張 API
| メソッド | エンドポイント | 説明 |
|----------|---------------|------|
| GET | /api/stock-movements | 入出庫履歴取得（フィルタ・ページネーション対応） |
| POST | /api/stock-movements | 手動入出庫記録（入庫/出庫/棚卸調整） |
| GET | /api/reports | レポート集計（期間指定・比較分析） |
| GET | /api/admin/users | ユーザー一覧取得（管理者専用） |
| PUT | /api/admin/users | ユーザーロール変更（管理者専用） |
| GET | /api/admin/audit-logs | 監査ログ取得（管理者専用） |
| GET | /api/auth/me | 現在のユーザー情報・権限取得 |
| POST | /api/seed-data | テストデータ生成 |

---

## 8. 進捗サマリー

### 基本機能（16ステップ: 全完了）
- ✅ 環境構築 → Supabase設定 → DB作成 → 認証 → Storage → データ移行
- ✅ Client実装 → 認証機能 → API実装 → フロントエンド → 画像管理
- ✅ CSV入出力 → リアルタイム → PWA対応 → テスト → デプロイ

### 拡張機能（12タスク中 6完了: 50%）
| # | タスク | 状態 |
|---|--------|------|
| 1 | CI/CDパイプラインの構築 | ✅ 完了 |
| 2 | エラー監視・ログ管理 | ✅ 完了 |
| 3 | データベースバックアップ戦略 | 🔲 未着手 |
| 4 | ユーザー権限管理の強化 | ✅ 完了 |
| 5 | 高度な在庫管理機能 | ✅ 完了 |
| 6 | レポート・分析機能の拡張 | ✅ 完了 |
| 7 | モバイルアプリ対応の強化 | 🔲 未着手 |
| 8 | 多言語対応（国際化） | 🔲 未着手 |
| 9 | 高度な検索機能 | 🔲 未着手 |
| 10 | サードパーティ連携 | 🔲 未着手 |
| 11 | パフォーマンス最適化 | 🔲 未着手 |
| 12 | アクセシビリティ対応 | 🔲 未着手 |

---

> **本ドキュメントは `docs/requirements.md` と `docs/FUTURE-TASKS.md` の内容を基に自動生成されました。**
