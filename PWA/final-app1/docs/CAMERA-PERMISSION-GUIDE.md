# カメラ使用許可ガイド

バーコードスキャン機能を使用するには、ブラウザにカメラの使用を許可する必要があります。

## 📷 ブラウザ別の許可方法

### Chrome / Microsoft Edge

#### 方法1: 自動プロンプトから許可

1. 在庫管理ページ（`http://localhost:3000/inventory`）を開く
2. **「📷 バーコードスキャン」**ボタンをクリック
3. 画面上部に表示されるポップアップで**「許可」**をクリック

#### 方法2: 手動で設定

1. アドレスバーの左側にある**🔒（鍵マーク）**をクリック
2. **「サイトの設定」**をクリック
3. **「カメラ」**の項目を探す
4. ドロップダウンから**「許可」**を選択
5. ページをリロード（F5キー）

#### 方法3: ブラウザ設定から

1. Chrome設定を開く（`chrome://settings/content/camera`）
2. **「許可」**セクションに `http://localhost:3000` を追加
3. ページをリロード

### Firefox

#### 方法1: 自動プロンプトから許可

1. バーコードスキャンボタンをクリック
2. ポップアップで**「許可」**をクリック
3. **「決定を記憶する」**にチェックを入れる（推奨）

#### 方法2: 手動で設定

1. アドレスバーの左側の**🔒**をクリック
2. **「接続の詳細を表示」** → **「詳細を表示」**
3. **「権限」**タブをクリック
4. **「カメラ」**の項目で**「許可」**を選択
5. ページをリロード

### Safari（Mac）

1. **Safari** → **「環境設定」** → **「Webサイト」**
2. 左側のメニューから**「カメラ」**を選択
3. `localhost`を探して**「許可」**を選択
4. ページをリロード

## 📱 スマートフォンでの設定

### Android（Chrome）

#### アプリ内での許可

1. バーコードスキャンボタンをタップ
2. **「許可」**をタップ

#### システム設定から

1. スマホの**「設定」**アプリを開く
2. **「アプリ」**または**「アプリケーション」**をタップ
3. **「Chrome」**を探してタップ
4. **「権限」**をタップ
5. **「カメラ」**をタップ
6. **「許可」**を選択
7. Chromeを再起動

### iPhone（Safari）

#### システム設定から（必須）

1. **「設定」**アプリを開く
2. 下にスクロールして**「Safari」**をタップ
3. **「カメラ」**を探す
4. **「許可」**または**「確認」**を選択
5. Safariを完全に終了して再起動

#### PWAとしてインストールした場合

1. **「設定」**アプリを開く
2. 下にスクロールしてアプリ名を探す
3. **「カメラ」**をタップ
4. **「許可」**を選択

## 🔍 トラブルシューティング

### カメラが起動しない場合

#### 1. HTTPSまたはlocalhostで実行されているか確認

カメラAPIは以下の環境でのみ動作します：
- ✅ `https://` で始まるURL
- ✅ `http://localhost` または `http://127.0.0.1`
- ❌ `http://192.168.x.x`（ローカルネットワークIP）

**解決方法**: 
- 開発環境では `http://localhost:3000` を使用
- 本番環境では必ずHTTPSを使用

#### 2. 他のアプリがカメラを使用していないか確認

- Zoom、Skype、Teams などのビデオ会議アプリを終了
- 他のブラウザタブでカメラを使用していないか確認

#### 3. ブラウザのキャッシュをクリア

1. **Ctrl+Shift+Delete**（Windows）または **Cmd+Shift+Delete**（Mac）
2. **「キャッシュされた画像とファイル」**を選択
3. **「データを削除」**をクリック
4. ブラウザを再起動

#### 4. ブラウザを最新版に更新

古いブラウザではカメラAPIが正しく動作しない場合があります。

#### 5. カメラドライバーの確認（Windows）

1. **デバイスマネージャー**を開く
2. **「カメラ」**または**「イメージングデバイス」**を展開
3. カメラに**!**マークがないか確認
4. 問題がある場合は右クリック → **「ドライバーの更新」**

#### 6. プライバシー設定の確認（Windows 10/11）

1. **設定** → **「プライバシーとセキュリティ」**
2. **「カメラ」**をクリック
3. **「アプリがカメラにアクセスできるようにする」**がオンになっているか確認
4. **「デスクトップアプリがカメラにアクセスできるようにする」**もオンにする

### エラーメッセージ別の対処法

#### "NotAllowedError: Permission denied"
→ ブラウザでカメラの使用を拒否しています。上記の手順で許可してください。

#### "NotFoundError: Requested device not found"
→ カメラが接続されていないか、認識されていません。
- カメラが正しく接続されているか確認
- 外付けカメラの場合、USBケーブルを挿し直す

#### "NotReadableError: Could not start video source"
→ カメラが他のアプリで使用中です。
- 他のアプリを終了してから再試行

#### "OverconstrainedError"
→ カメラが要求された解像度をサポートしていません。
- 通常は自動的に調整されますが、問題が続く場合はサポートに連絡

## 🧪 カメラ動作テスト

カメラが正しく動作するか確認するには：

1. ブラウザで以下のサイトにアクセス：
   - Chrome: `chrome://settings/content/camera`
   - Firefox: `about:preferences#privacy` → カメラ
   - または https://webcamtests.com/ などのテストサイト

2. カメラの映像が表示されればOK

## 📞 それでも解決しない場合

以下の情報を確認してください：

1. **ブラウザ名とバージョン**
   - Chrome: `chrome://version`
   - Firefox: `about:support`

2. **OS（Windows / Mac / iOS / Android）**

3. **エラーメッセージ**（ブラウザのコンソールに表示される場合）
   - F12キーを押してConsoleタブを確認

4. **カメラの種類**
   - 内蔵カメラ / 外付けUSBカメラ

## 💡 ヒント

### 開発環境での推奨設定

- **localhost**を使用（IPアドレスではなく）
- カメラ許可を**「記憶する」**に設定
- 開発者ツール（F12）を開いてエラーを確認

### 本番環境での推奨設定

- 必ず**HTTPS**を使用
- 初回アクセス時にカメラ許可の案内を表示
- カメラが使用できない場合の代替手段（手入力）を用意

## 🔐 プライバシーについて

- カメラ映像はブラウザ内でのみ処理され、サーバーには送信されません
- バーコード認識はローカル（デバイス内）で実行されます
- 撮影された画像は保存されません
